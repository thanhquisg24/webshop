<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<base href="/">
<title>Add/Edit Product</title>
<base
	th:href="${@environment.getProperty('layout.thymleaf.admin.head.base.href')}" />
<meta
	content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'
	name='viewport'>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
<!-- global css -->
<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<!-- font Awesome -->
<link href="vendors/font-awesome-4.2.0/css/font-awesome.min.css"
	rel="stylesheet" type="text/css" />
<link href="css/styles/black.css" rel="stylesheet" type="text/css"
	id="colorscheme" />
<link href="css/panel.css" rel="stylesheet" type="text/css" />
<link href="css/metisMenu.css" rel="stylesheet" type="text/css" />
<!-- end of global css -->
<!--page level css -->
<link href="vendors/fullcalendar/css/fullcalendar.css" rel="stylesheet"
	type="text/css" />
<link href="css/pages/calendar_custom.css" rel="stylesheet"
	type="text/css" />
<link rel="stylesheet" media="all"
	href="vendors/jvectormap/jquery-jvectormap.css" />
<link href="vendors/select2/select2.css" rel="stylesheet">
<link rel="stylesheet" href="vendors/select2/select2-bootstrap.css">
<link href="vendors/jasny-bootstrap/css/jasny-bootstrap.css"
	rel="stylesheet">
<link  rel="stylesheet" type="text/css" href="vendors/sweetalert/dist/sweetalert.css">
<link href="css/text.css" rel="stylesheet">
 <!-- Common Kendo UI CSS for web widgets and widgets for data visualization. -->
            <link href="kendo/styles/kendo.common.min.css" rel="stylesheet" />
            
                        <!-- Default Kendo UI theme CSS for web widgets and widgets for data visualization. -->
  
 		  <link href="kendo/styles/kendo.silver.min.css" rel="stylesheet" />
            <!-- (Optional) RTL CSS for Kendo UI widgets for the web. Include only in right-to-left applications. -->
            <link href="kendo/styles/kendo.rtl.min.css" rel="stylesheet" type="text/css" />

<!--end of page level css-->
<!--end of page level css-->
</head>
<body class="skin-josh">
	<header class="header" th:replace="admin/layout/header :: header"></header>
	<div class="wrapper row-offcanvas row-offcanvas-left">
		<!-- Left side column. contains the logo and sidebar -->
		<aside class="left-side sidebar-offcanvas"
			th:replace="admin/layout/_leftsidebar :: left(active='catalog',subactive='product')">
		</aside>

		<!-- Right side column. Contains the navbar and content of the page -->
		<aside class="right-side">
			<section class="content-header">
				<h1>
					Add/Edit Product<small><i class="fa fa-arrow-circle-left"></i><a
						th:href="@{/admin/product/}">back to Product list</a></small>
				</h1>

			</section>
			  <!-- /* Handle the flash message */-->
									    <th:block th:if="${message != null}">
									        <!-- /* The message code is returned from the @Controller */ -->
									        <div th:replace="admin/layout/alert :: alert (type=${#strings.toLowerCase(message.type)}, message=#{${message.message}(${#authentication.name})})">&nbsp;</div>
									    </th:block>
									      <!-- /* end Handle the flash message */-->		
			<section class="content">
				<div class="row">
					<div class="col-md-12" style="padding-bottom: 10px;">
						<button class="btn btn-primary" type="submit" id="btnSaveProduct">
							<i class="fa fa-floppy-o"></i> Save
						</button>
						<button class="btn btn-primary" type="submit" id="btnSaveProductAndContinue">
							<i class="fa fa-floppy-o"></i> Save and continue Edit
						</button>
						<button type="button" id="delete-product" class="btn btn-danger"><i class="fa fa-trash-o"></i>Delete </button>
					</div>
					<div class="col-md-12">
						<div class="panel panel-white">
							<div class="panel-body">

								<!-- Custom Tabs -->
								<div class="bs-example">
									<ul class="nav nav-tabs" style="margin-bottom: 15px;">
										<li class="active"><a href="#product_info"
											data-toggle="tab">Product Info</a></li>
										<li><a href="#product_pic" data-toggle="tab">Picture</a></li>
										<li><a href="#product_attribute" data-toggle="tab">Product
												Attribute</a></li>
										<li><a href="#related_products" data-toggle="tab">Related
												products</a></li>
									</ul>
									<div class="tab-content" id="slim2">
										<!-- /.tab-pane -->
									<div class="tab-pane active" id="product_info" th:replace="admin/catalogue/product/fag_product_info :: product_info"></div>
									<!-- /.tab-pane -->


									<!-- /.tab-pane -->
									<div class="tab-pane" id="product_pic" th:replace="admin/catalogue/product/fag_product_image :: fag-product-image">123213</div>
									<!-- /.tab-pane -->


									<!-- /.tab-pane -->
									<div class="tab-pane" id="product_attribute"></div>
									<!-- /.tab-pane -->
									<!-- /.tab-pane -->
									<div class="tab-pane" id="related_products"></div>
									<!-- /.tab-pane -->
								</div>
								<!-- /.tab-content -->
							</div>
							<!-- nav-tabs-custom -->




						</div>
					</div>
		</div>
	</div>
	<!--/row-->

	</section>
	</aside>
	<!-- right-side -->
	</div>
	<div id="footer_global"
		th:replace="admin/layout/footer :: footer_global"></div>
	<!-- begining of page level js -->
	<!--  todolist-->
	<script src="vendors/jasny-bootstrap/js/jasny-bootstrap.js"></script>
	<script src="vendors/select2/select2.js" type="text/javascript"></script>
	<script src="vendors/sweetalert/dist/sweetalert.min.js"></script>
	
	
	
	
	<script th:inline="javascript">
		/*<![CDATA[*/
		$(document)
				.ready(
						function() {
						    $("#sl2category").select2();
						    $("#delete-product").click(function(){
						    	swal({
						    		  title: "Are you sure?",
						    		  text: "You will  be deleted  this product !",
						    		  type: "warning",
						    		  showCancelButton: true,
						    		  confirmButtonColor: "#DD6B55",
						    		  confirmButtonText: "Yes, delete it!",
						    		  closeOnConfirm: false
						    		},
						    		function(){
						    			var datapost={"id":$("#frm-product input[name='id']").val()};
						    			
						    			 $
						                    .ajax({
						                        type: "POST",
						                        url: "admin/product/delete",
						                        data:datapost,
						                        //contentType: "json",
						                        cache: false,
						                        timeout: 600000,
						                        success: function(data) {
						                            if (data.message == "success") {
						                                //window.location.href = serverContext + "successRegister.html";
						                            	  swal("Deleted!", "Your product has been deleted.", "success");
						                            }

						                        },
						                        error: function(response) {
						                            if (response.status==500 ) {
						                                //window.location.href = serverContext + "login?message=" + data.responseJSON.message;
						                               // alert("InternalError!");
						                                swal("Ops!", "InternalError!", "error");
						                            } else {
						                            	 //console.log(response);
						                            	  //console.log((response.responseJSON.message));
						                            	   swal("Ops!", response.responseJSON.message, "error");
						                         
						                            }

						                        }
						                    });
						    		
						    		});
						    });
							$("#btnSaveProductAndContinue").click(function(){
								
							});
							$("#btnSaveProduct").click(function(){
								$("#frm-product").submit();
							});
							
							/*product image*/
							$('#frm-product-img').submit(function(event) {
								submmit(event);
							});

							function submmit(event) {
								event.preventDefault();
								$(".alert").html("").hide();
								$(".error-list").html("");
								//var formData= $('#frm-product-img').serialize();
								/*$.post("admin/product-image/save",formData ,function(data){
								    if(data.message == "success"){
								        //window.location.href = serverContext + "successRegister.html";
								        alert("success");
								    }
								    
								})
								.fail(function(data) {
								    if(data.responseJSON.error.indexOf("InternalError") > -1){
								        //window.location.href = serverContext + "login?message=" + data.responseJSON.message;
								    	  alert("InternalError!");
								    }
								    else{
								    	var errors = $.parseJSON(data.responseJSON.message);
								        $.each( errors, function( index,item ){
								            $("#"+item.field+"Error").show().html(item.defaultMessage);
								        });
								        errors = $.parseJSON(data.responseJSON.error);
								        $.each( errors, function( index,item ){
								            $("#globalError").show().append(item.defaultMessage+"<br/>");
								        });
								    }
								});*/
								var form = $('#frm-product-img')[0];
								var data = new FormData(form);
								$
										.ajax({
											type : "POST",
											enctype : 'multipart/form-data',
											url : "admin/product-image/save",
											data : data,
											processData : false,
											contentType : false,
											cache : false,
											timeout : 600000,
											success : function(data) {
												if (data.message == "success") {
													//window.location.href = serverContext + "successRegister.html";
													alert("success");
												}

											},
											error : function(data) {
												if (data.responseJSON.error
														.indexOf("InternalError") > -1) {
													//window.location.href = serverContext + "login?message=" + data.responseJSON.message;
													alert("InternalError!");
												} else {
													var errors = $
															.parseJSON(data.responseJSON.message);
													$
															.each(
																	errors,
																	function(
																			index,
																			item) {
																		$(
																				"#"
																						+ item.field
																						+ "Error")
																				.show()
																				.html(
																						item.defaultMessage);
																	});
													errors = $
															.parseJSON(data.responseJSON.error);
													$
															.each(
																	errors,
																	function(
																			index,
																			item) {
																		$(
																				"#globalError")
																				.show()
																				.append(
																						item.defaultMessage
																								+ "<br/>");
																	});
												}

											}
										});
							}
						});
		/*]]>*/
	</script>
		<script th:inline="javascript" th:if="${productDTO.id} > 0">
		/*<![CDATA[*/

                    $(document).ready(function() {
                    	
                    	var product_id=/*[[${productDTO.id}]]*/;
                    	function additionalData() {
                            var data = {
                            		id: product_id,
                           
                            };
                            return data;
                        }
                    	
                        $("#grid-product-image").kendoGrid({
                            dataSource: {
                                type: "json",
                                transport: {
                                    read: {
                                        url: "/admin/product-image/get?productId="+product_id,
                                        type: "POST",
                                        dataType: "json"
                                    },
                                    update: {
                                        url: "/admin/product-image/ProductPictureUpdate",
                                        type: "POST",
                                        dataType: "json",
                                        data: additionalData
                                    },
                                    destroy: {
                                        url: "/admin/product-image/ProductPictureDelete",
                                        type: "POST",
                                        dataType: "json",
                                        data: additionalData
                                    }
                                },
                                schema: {
                                    data: "data",
                                    total: "total",
                                    //errors: "Errors",
                                    model: {
                                        id: "id",
                                        fields: {
                                        	productImage: { editable: false, type: "string" },
                                            displayOrder: { editable: true, type: "number" },
                                            altTag: { editable: true, type: "string" },
                                            title: { editable: true, type: "string" },
                                            defaultImage: { editable: true,type: "boolean" }
                                        }
                                    }
                                },
                                requestEnd: function(e) {
                                    if (e.type == "update") {
                                        this.read();
                                    }
                                },
                                error: function(e) {
                                	console.log(e);
                                    display_kendoui_grid_error(e);
                                    // Cancel the changes
                                    this.cancelChanges();
                                },
                                serverPaging: false,
                                serverFiltering: false,
                                serverSorting: false
                            },
                            pageable: {
                                refresh: true,
                                numeric: false,
                                previousNext: false,
                                info: false,
                                messages: {
    display: "{0} - {1} of {2} items",
    empty: "No items to display",
    page: "Page",
    of: "of {0}",
    itemsPerPage: "items per page",
    first: "Go to the first page",
    previous: "Go to the previous page",
    next: "Go to the next page",
    last: "Go to the last page",
    refresh: "Refresh",
    allPages: "All",
    morePages: "More pages"
}
                            },
                            editable: {
                                confirmation: "Are you sure you want to delete this item?",
                                mode: "inline"
                            },
                            scrollable: false,
                            columns: [
                            {
                                field: "productImage",
                                title: "Picture",
                                template: '<a href="#=productImage#" target="_blank"><img alt="#=productImage#" src="#=productImage#" width="150" /></a>',
                                width: 200
                            }, {
                                field: "displayOrder",
                                title: "Display order",
                                //integer format
                                format: "{0:0}",
                                width: 150
                            }, {
                                field: "altTag",
                                title: "Alt",
                                width: 200
                            }, {
                                field: "title",
                                title: "Title",
                                width: 200
                            }, {
                                command: [
                                {
                                    name: "edit",
                                    text: {
                                        edit: "Edit",
                                        update: "Update",
                                        cancel: "Cancel"
                                    }
                                }, {
                                    name: "destroy",
                                    text: "Delete"
                                }
                                ],
                                width: 200
                            }
                            ]
                        });
                    });
                    /*]]>*/ 
                </script>
	<!-- end of page level js -->

</body>
</html>
